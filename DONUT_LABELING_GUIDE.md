# 도넛(Donut) 패턴 라벨링 가이드

## ⚠️ 현재 LabelImg 설정 문제

이미지에서 보이는 것은 **폴리곤/키포인트 라벨링** 형식입니다.
- ✅ 녹색 점들과 보라색 선으로 연결된 형태
- ❌ **YOLO는 이 형식을 지원하지 않습니다!**

**YOLO Detection은 bounding box (사각형)만 지원합니다.**

---

## ✅ 도넛 패턴 올바른 라벨링 방법

### 방법 1: 개별 불량 클러스터를 박스로 표시 (추천)

도넛 패턴은 중앙이 비어있고 중간 링 영역에 불량이 분포합니다.
각 불량 클러스터를 **개별 bounding box**로 표시하세요.

**라벨링 단계:**
1. LabelImg에서 **"Create RectBox"** 버튼 클릭 (또는 `W` 키)
2. 각 불량 클러스터 영역을 드래그하여 **사각형 박스** 생성
3. 클래스명: `defect` 입력
4. 여러 개의 박스가 있을 수 있음 (정상)

**예시:**
```
도넛 이미지에서:
- 중간 링 영역의 불량 클러스터 1 → 박스 1
- 중간 링 영역의 불량 클러스터 2 → 박스 2
- 중간 링 영역의 불량 클러스터 3 → 박스 3
...
```

---

### 방법 2: 전체 도넛 불량 영역을 하나의 박스로 표시

불량이 넓게 분포되어 있거나 개별 클러스터를 구분하기 어려운 경우,
**전체 도넛 영역(링 부분)을 하나의 큰 박스**로 표시할 수 있습니다.

**라벨링 단계:**
1. 중앙 비어있는 영역은 제외
2. 외곽 링 영역 전체를 하나의 사각형으로 감싸기
3. 클래스명: `defect` 입력

**주의:** 이 방법은 덜 정확할 수 있습니다.

---

## 🎯 도넛 패턴 특징

```
┌─────────────────────────┐
│                         │
│    ┌─────────────┐      │
│    │             │      │
│    │   (정상)     │      │  ← 중앙: 정상 영역
│    │             │      │
│    │ ┌─────────┐ │      │
│    └─│ 불량영역 │─┘      │  ← 중간 링: 불량 영역
│      │ (도넛)   │        │
│      └─────────┘        │
│                         │
└─────────────────────────┘
```

---

## 📋 LabelImg 설정 확인

### ✅ 올바른 설정:

1. **좌측 상단 "PascalVOC" 버튼 클릭** → **"YOLO" 선택**
   - YOLO 형식으로 저장해야 함

2. **"Create RectBox" 버튼 사용** (또는 `W` 키)
   - **사각형 박스**만 생성
   - 폴리곤/키포인트가 아닌 **직사각형**으로 그리기

3. **박스 그리기 방법:**
   - 마우스로 드래그하여 사각형 생성
   - 불량 영역을 완전히 감싸는 최소 크기의 사각형

4. **클래스명:** `defect` 입력

---

## 🔄 현재 폴리곤 → 박스 변환

이미 폴리곤으로 라벨링한 경우:

### Option 1: LabelImg에서 다시 라벨링
1. 기존 라벨 삭제
2. "Create RectBox"로 사각형 박스 생성

### Option 2: 자동 변환 (간단)
현재 프로젝트에 변환 스크립트가 있습니다:
- `utils/convert_segmentation_to_detection.py`
- 폴리곤 좌표를 bounding box로 자동 변환

---

## 💡 도넛 패턴 라벨링 팁

### Tip 1: 개별 클러스터 우선
- 각 불량 클러스터를 개별 박스로 표시
- 정확도가 높아짐

### Tip 2: 너무 작은 박스는 제외
- 신뢰도가 낮은 작은 박스는 제외
- 명확한 불량 영역만 표시

### Tip 3: 중앙 정상 영역 제외
- 도넛 패턴의 중앙은 정상이므로 박스에서 제외
- 중간 링 영역만 표시

---

## ✅ 검증

라벨링이 올바른지 확인:

```bash
# 라벨 파일 확인
cat dataset/Donut/679360.txt
```

**올바른 형식:**
```
0 0.5 0.5 0.2 0.3
0 0.7 0.5 0.15 0.25
```

- 각 줄이 하나의 박스 (5개 값)
- `0`: 클래스 ID
- `0.5 0.5`: 중심 좌표
- `0.2 0.3`: 너비, 높이

**잘못된 형식 (폴리곤):**
```
0 0.78125 0.125 0.8421875 0.125 0.8421875 0.1859375 ...
```

---

## 🚀 다음 단계

1. **LabelImg 설정 확인:**
   - "YOLO" 형식 선택
   - "Create RectBox" 사용

2. **도넛 이미지 다시 라벨링:**
   - 각 불량 클러스터를 사각형 박스로 표시
   - 클래스명: `defect`

3. **라벨링 진행 상황 확인:**
   ```bash
   python utils/check_labeling_status.py
   ```

4. **YOLO 학습:**
   ```bash
   python utils/convert_labels_to_yolo.py organize \
       --image-dir dataset/ --labels-dir dataset/ --output-dir yolo_dataset/
   python train_yolo.py --data yolo_dataset/dataset.yaml --epochs 100
   ```

---

## 📝 요약

**도넛 패턴 라벨링:**
- ✅ **사각형 박스(bounding box)** 사용
- ✅ 각 불량 클러스터를 개별 박스로 표시
- ❌ 폴리곤/키포인트 사용하지 않기

**현재 LabelImg 화면에서 보이는 것:**
- 폴리곤 형식 → **YOLO와 호환 안 됨**
- "Create RectBox"로 사각형 박스 다시 그리기 필요


