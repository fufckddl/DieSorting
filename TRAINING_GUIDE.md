# 모델 학습 가이드

## 학습 가능 여부 및 데이터 요구사항

### ✅ 패턴 분류 모델 (Step C) - 학습 가능, 박스 라벨링 불필요

**데이터 요구사항:**
- ✅ **이미지 + 클래스 라벨만 필요** (bbox 라벨링 불필요)
- ✅ Wafer-map 이미지를 패턴별로 분류된 데이터만 있으면 됨

**데이터셋 구조:**
```
dataset/
  local/
    wafer_map_001.png
    wafer_map_002.png
    ...
  edge-local/
    wafer_map_003.png
    ...
  donut/
    ...
  edge-ring/
    ...
  scratch/
    ...
  near-full/
    ...
  none/
    ...
```

**장점:**
- 수집하기 쉬움 (이미 패턴이 분류된 wafer-map만 있으면 됨)
- 라벨링 작업이 간단함 (이미지 분류만)

**학습 방법:**
```bash
python train_pattern_classifier.py --data-dir dataset/ --epochs 100
```

---

### ❓ YOLO 검출 모델 (Step A) - 박스 라벨링 필요

**데이터 요구사항:**
- ⚠️ **bbox 라벨링이 필요함** (각 불량의 위치를 박스로 표시)
- 반도체 불량 이미지 + YOLO 형식 annotation 필요

**YOLO 형식 annotation 예시:**
```
# image.txt 파일 (이미지와 같은 이름)
0 0.5 0.5 0.1 0.1  # class_id center_x center_y width height (정규화된 좌표)
0 0.3 0.7 0.05 0.05
```

**문제점:**
- 라벨링 작업이 매우 시간 소모적
- 각 이미지의 모든 불량에 대해 박스를 그려야 함

---

## 대안적인 접근법

### 옵션 1: 패턴 분류 모델만 학습 (권장 ⭐)

**장점:**
- YOLO 학습 불필요 (사전학습 모델 사용)
- 패턴 분류만 학습하면 전체 파이프라인 개선 가능
- 데이터 수집 및 라벨링이 훨씬 쉬움

**방법:**
1. 기존에 분류된 wafer-map 데이터 사용
2. 또는 YOLO 검출 결과(부정확해도 OK) → wafer-map 생성 → 패턴 라벨링
3. 패턴 분류 모델만 학습

**실제로 가능한 이유:**
- 현재 파이프라인에서 YOLO는 "불량 위치 검출"만 수행
- 정확도가 낮아도, 여러 불량을 검출하면 wafer-map에서 패턴이 나타남
- 패턴 분류 모델이 잘 학습되면 전체 성능이 크게 향상됨

### 옵션 2: YOLO 없이 다른 검출 방법 사용

**대안:**
- 전통적인 이미지 처리 (threshold, contour detection 등)
- 이미 처리된 불량 좌표 데이터 사용
- 다른 사전학습 모델 활용

### 옵션 3: Weakly Supervised Learning

**접근법:**
- 이미지 레벨 라벨만 사용 (bbox 불필요)
- CAM (Class Activation Map) 같은 방법으로 불량 위치 추정
- 하지만 구현 복잡도가 높음

---

## 추천 학습 전략

### 단계별 접근 (점진적 개선)

**Phase 1: 패턴 분류 모델만 학습** (즉시 가능)
1. 기존 wafer-map 데이터 수집
2. 패턴별로 디렉터리 분류
3. `train_pattern_classifier.py`로 학습
4. **예상 효과: 신뢰도 15% → 70-90%**

**Phase 2: YOLO 검출 모델 학습** (나중에, 선택적)
1. 불량 이미지 수집
2. bbox 라벨링 (시간 소모적)
3. `train_yolo.py`로 학습
4. **예상 효과: 검출 정확도 향상**

### 즉시 실행 가능한 학습 방법

**가장 빠른 방법:**
```bash
# 1. Wafer-map 데이터 준비 (패턴별 디렉터리)
mkdir -p dataset/{local,edge-local,donut,edge-ring,scratch,near-full,none}

# 2. 각 디렉터리에 해당 패턴의 wafer-map 이미지 복사

# 3. 패턴 분류 모델 학습
python train_pattern_classifier.py --data-dir dataset/ --epochs 100 --batch-size 32

# 4. 자동으로 weights/pattern_classifier.pt에 저장됨
```

---

## 데이터 수집 방법

### 방법 1: 기존 데이터 활용
- 이미 분류된 wafer-map 데이터
- 연구 논문 데이터셋
- 공개 데이터셋

### 방법 2: YOLO 결과로 자동 생성 (반자동)
1. 현재 YOLO로 검출 (부정확해도 OK)
2. `utils/wafer_map.py`로 wafer-map 생성
3. 사람이 패턴을 확인하고 디렉터리에 분류
4. 충분한 데이터 수집 후 학습

### 방법 3: 시뮬레이션 데이터 생성
- 패턴별로 불량 위치를 알고리즘으로 생성
- Wafer-map 생성
- 학습 데이터로 활용

---

## 결론

### ✅ 학습 가능 여부

| 모델 | 학습 가능? | 박스 라벨링 필요? | 난이도 |
|------|-----------|-----------------|--------|
| 패턴 분류 모델 | ✅ 가능 | ❌ 불필요 | 쉬움 |
| YOLO 검출 모델 | ✅ 가능 | ⚠️ 필요 | 어려움 |

### 💡 권장사항

1. **먼저 패턴 분류 모델만 학습**하는 것을 강력히 권장합니다.
   - 데이터 준비가 쉽고
   - 효과가 즉시 나타나며
   - YOLO 학습 없이도 파이프라인 개선 가능

2. YOLO 학습은 선택적으로 나중에 진행
   - 패턴 분류 모델 학습 후 성능이 만족스럽지 않을 때
   - bbox 라벨링 데이터가 충분히 준비되었을 때

3. 현재 사전학습 YOLO로도 충분할 수 있음
   - 검출이 부정확해도, wafer-map에서는 패턴이 나타날 수 있음
   - 패턴 분류 모델이 잘 학습되면 전체 성능 향상 가능

